<!DOCTYPE html>
<html lang="cs">
<head> 
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#f5f5f5"> <!-- Barva z√°hlav√≠ prohl√≠≈æeƒçe v mobiln√≠ch za≈ô√≠zen√≠ch -->
    <meta name="format-detection" content="telephone=no"> <!-- Zabr√°n√≠ automatick√©mu form√°tov√°n√≠ telefonn√≠ch ƒç√≠sel -->
    <meta name="mobile-web-app-capable" content="yes"> <!-- Pro mo≈ænost p≈ôid√°n√≠ na plochu jako aplikace -->
    <meta name="apple-mobile-web-app-capable" content="yes"> <!-- Pro iOS za≈ô√≠zen√≠ -->
    <title>{% block title %}Hejbni kostrou!{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <!-- P≈ôid√°n√≠ odkazu na favicon -->
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">

    <style>
        /* üîπ Z√ÅKLADN√ç NASTAVEN√ç STR√ÅNKY */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* üîπ BODY - z√°kladn√≠ nastaven√≠ */
        body {
            font-family: "Comic Sans MS", cursive, sans-serif;
            background-color: transparent !important;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            justify-content: flex-start;
            padding: 0 4vw; /* P≈ôevedeno z cm na vw */
            width: 100%;
        }

        /* üîπ POZAD√ç STR√ÅNKY */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url("{{ url_for('static', filename='pozadi.jpg') }}") center / 110% no-repeat fixed;
            opacity: 0.2;
            z-index: -100;
        }

        /* üîπ HLAVN√ç KONTEJNER */
        .container {
            max-width: 100%;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        /* üîπ HLAVN√ç NADPIS */
        h1 {
            font-size: 4vw;
            font-weight: bold;
            font-style: italic;
            color: black;
            text-shadow: 0.2vw 0.2vw 0.3vw rgba(0, 0, 0, 0.6);
            text-align: left;
            line-height: 1.2;
            letter-spacing: 0.03vw;
            width: 100%;
            margin-top: 1.5vw;
            margin-bottom: 1.2vw;
            padding: 0;
            margin-left: -4.5vw;
            white-space: nowrap;
        }

        /* üîπ ≈†KOLN√ç ROK V PRAV√âM ROHU */
        .skolni-rok {
            position: absolute;
            top: 0.5vw;
            right: 3vw;
            font-size: clamp(0.8rem, 1vw, 1.1rem);
            font-weight: normal;
        }

        /* üîπ LOGO DOM≈Æ */
        .logo-home {
            position: absolute;
            top: 3vw;
            right: 3vw;
            z-index: 1000;
            pointer-events: auto;
        }

        .logo-home img {
            width: clamp(30px, 3vw, 50px);
            height: auto;
            cursor: pointer;
        }

        /* üîπ Obal pro obsah s paddingem pro mobiln√≠ za≈ô√≠zen√≠ */
        .page-wrapper {
            width: 100%;
            padding: 0 1vw;
        }

        /* üì± RESPONSIVITA pro mobiln√≠ za≈ô√≠zen√≠ */
        @media (max-width: 768px) {
            body {
                padding: 0 3vw;
            }

            .container {
                width: 100%;
                padding: 0 1vw;
            }

            h1 {
                font-size: 2.2rem !important;
                text-align: center !important;
                white-space: normal !important;
                margin-left: 0;
                margin-top: 3rem;
            }

            .content-container, 
            .trida-content-container, 
            .seznam-container {
                flex-direction: column;
                align-items: center;
                text-align: center;
                gap: 4vw;
                width: 95% !important;
                margin: 0 auto;
            }

            .logo-trida-container, 
            .logo-wrapper {
                width: 100%;
                display: flex;
                justify-content: center;
                margin-top: 2vw;
            }

            .logo-trida, 
            .logo-vyhledavani, 
            .logo-chlapec, 
            .logo-divka {
                max-width: 60vw;
                height: auto;
            }

            .sloupec, 
            .seznam-trid-container {
                width: 90%;
                text-align: center;
                margin-left: auto;
                margin-right: auto;
            }

            .oddeleni {
                display: none;
            }

            .skolni-rok {
                top: 0.5rem;
                right: 1rem;
                font-size: 0.8rem;
            }

            .logo-home {
                top: 1.8rem;
                right: 1rem;
            }

            .student-info-table {
                margin-left: 0 !important;
                width: 90vw;
            }

            .info-box {
                margin-left: auto;
                margin-right: auto;
            }

            .left-side, .right-side {
                margin-left: auto;
                margin-right: auto;
                text-align: center;
            }

            .discipline-table th,
            .bonus-table th,
            .penalty-table th,
            .grading-table th {
                font-size: 0.9rem;
            }

            .discipline-table td,
            .bonus-table td,
            .penalty-table td,
            .grading-table td {
                font-size: 0.85rem;
                padding: 0.5rem;
            }
        }

        /* Pro men≈°√≠ mobiln√≠ za≈ô√≠zen√≠ */
        @media (max-width: 480px) {
            h1 {
                font-size: 1.8rem !important;
                margin-top: 4rem;
            }

            .button, 
            .search-container, 
            .skolni-rok-container {
                width: 90vw !important;
                margin-left: auto !important;
                margin-right: auto !important;
            }

            .headline-container {
                position: static !important;
                width: 90% !important;
                margin: 1rem auto !important;
                top: 0 !important;
                left: 0 !important;
            }

            .headline-container h2 {
                font-size: 1rem !important;
            }

            .menu-container {
                position: static !important;
                width: 100% !important;
                margin: 0 auto !important;
                right: 0 !important;
            }
        }
    </style>
</head>

<body id="{% block body_id %}{% endblock %}">

    <!-- üîπ ≈†koln√≠ rok v prav√©m horn√≠m rohu -->
    <div class="skolni-rok">
        üìÖ ≈†koln√≠ rok: <span id="skolni-rok-text">---</span>
    </div>    

    <!-- üîπ Logo ‚ÄûDom≈Ø" -->
    <div class="logo-home">
        <a href="{{ url_for('home') }}">
            <img src="{{ url_for('static', filename='logo.png') }}" alt="Dom≈Ø">
        </a>
    </div>

    <!-- P≈ôidejte toto do <body> hned za hlaviƒçku -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-messages">
                {% for category, message in messages %}
                    <div class="flash-message {{ category }}">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- üîπ Hlavn√≠ obsah str√°nky -->
    <div class="page-wrapper">
        <div class="container">
            {% block content %}{% endblock %}
        </div>
    </div>

<!-- ‚úÖ Skript pro spr√°vn√© naƒç√≠t√°n√≠ a aktualizaci ≈°koln√≠ho roku -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Synchronizace localStorage a session p≈ôi naƒçten√≠ str√°nky
        const ulozenySkolniRok = localStorage.getItem("skolniRok");
        if (ulozenySkolniRok) {
            // Vybereme spr√°vn√Ω rok v dropdown menu, pokud existuje
            const skolniRokSelect = document.getElementById("skolniRok");
            if (skolniRokSelect) {
                skolniRokSelect.value = ulozenySkolniRok;
            }
            
            // Aktualizujeme text roku v UI
            const skolniRokText = document.getElementById("skolni-rok-text");
            if (skolniRokText) {
                skolniRokText.innerText = ulozenySkolniRok;
            }
            
            // Po≈°leme async request pro aktualizaci session na serveru
            fetch("/synchronizovat_rok", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ rok: ulozenySkolniRok })
            }).catch(error => console.error("Chyba synchronizace roku:", error));
        } else {
            // Pokud rok nen√≠ v localStorage, pou≈æijeme v√Ωchoz√≠ hodnotu
            let defaultRok = getDefaultSkolniRok();
            localStorage.setItem("skolniRok", defaultRok);
            
            const skolniRokText = document.getElementById("skolni-rok-text");
            if (skolniRokText) {
                skolniRokText.innerText = defaultRok;
            }
            
            // Synchronizace s backend
            fetch("/synchronizovat_rok", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ rok: defaultRok })
            }).catch(error => console.error("Chyba synchronizace roku:", error));
        }
        
        let skolniRokText = document.getElementById("skolni-rok-text");
        let skolniRokSelect = document.getElementById("skolniRok");

        // üü¢ Funkce pro urƒçen√≠ aktu√°ln√≠ho ≈°koln√≠ho roku
        function getDefaultSkolniRok() {
            let dnes = new Date();
            let rok = dnes.getFullYear();
            let mesic = dnes.getMonth() + 1; // JavaScript mƒõs√≠ce jsou 0-11

            return mesic >= 9 ? `${rok}/${rok + 1}` : `${rok - 1}/${rok}`;
        }

        console.log("üìÖ Nastaven√Ω ≈°koln√≠ rok:", localStorage.getItem("skolniRok"));

        // üü¢ Event listener pro zmƒõnu ≈°koln√≠ho roku
        if (skolniRokSelect) {
            skolniRokSelect.addEventListener("change", function () {
                let vybranyRok = skolniRokSelect.value;

                // Ulo≈æ√≠me nov√Ω rok do localStorage a aktualizujeme text
                localStorage.setItem("skolniRok", vybranyRok);
                if (skolniRokText) {
                    skolniRokText.innerText = vybranyRok;
                }

                console.log("üìÖ ≈†koln√≠ rok zmƒõnƒõn na:", vybranyRok);

                // üü¢ Odesl√°n√≠ zmƒõny na server
                fetch("/zmen_skolni_rok", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ rok: vybranyRok })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.message) {
                        alert("‚úÖ " + data.message);
                        
                        // Kontrola zda m√°me prov√©st reload str√°nky
                        const currentPath = window.location.pathname;
                        if (currentPath.includes("/tridy") || 
                            currentPath.includes("/detail_tridy") || 
                            currentPath.includes("/zaci")) {
                            // Tyto str√°nky je pot≈ôeba reloadovat pro spr√°vn√© zobrazen√≠
                            location.reload();
                        }
                    } else {
                        alert("‚ùå Chyba: " + (data.error || "Nezn√°m√° chyba."));
                    }
                })
                .catch(error => {
                    console.error("‚ùå Chyba p≈ôi komunikaci se serverem:", error);
                    alert("‚ùå Chyba p≈ôi zmƒõnƒõ ≈°koln√≠ho roku.");
                });
            });
        }
    });
</script>

<!-- Optimalizace pro dotykov√© za≈ô√≠zen√≠ -->
<script>
    // Funkce pro lep≈°√≠ ovl√°d√°n√≠ na dotykov√Ωch za≈ô√≠zen√≠ch
    document.addEventListener('DOMContentLoaded', function() {
        // Nastaven√≠ aktu√°ln√≠ho data pro tisk
        const today = new Date();
        document.body.setAttribute('data-datum', today.toLocaleDateString('cs-CZ'));
        
        // Zji≈°tƒõn√≠, zda jde o dotykov√© za≈ô√≠zen√≠
        const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
        
        if (isTouchDevice) {
            // P≈ôid√°n√≠ t≈ô√≠dy k tƒõlu dokumentu pro CSS √∫pravy
            document.body.classList.add('touch-device');
            
            // P≈ôizp≈Øsoben√≠ input≈Ø pro numerick√© hodnoty
            const numericInputs = document.querySelectorAll('.discipline-table input, .bonus-table input, .penalty-table input');
            numericInputs.forEach(input => {
                // Pro numerick√© inputy nastav√≠me numerickou kl√°vesnici
                if (input.type === 'text' && !input.hasAttribute('pattern')) {
                    input.setAttribute('inputmode', 'decimal');
                }
            });
            
            // Obalen√≠ tabulek pro horizont√°ln√≠ scrollov√°n√≠
            const tables = document.querySelectorAll('.discipline-table, .bonus-table, .penalty-table, .grading-table, .student-info-table');
            tables.forEach(table => {
                // Pokud tabulka je≈°tƒõ nen√≠ v kontejneru pro scrollov√°n√≠
                if (!table.parentElement.classList.contains('table-container')) {
                    const wrapper = document.createElement('div');
                    wrapper.className = 'table-container';
                    table.parentNode.insertBefore(wrapper, table);
                    wrapper.appendChild(table);
                }
            });
        }
    });
</script>

</body>
</html>
