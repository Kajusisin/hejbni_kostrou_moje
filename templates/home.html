{% extends 'base.html' %}

{% block title %}Hejbni kostrou! - Fitness Aplikace pro ZÃ¡kladnÃ­ Å kolu{% endblock %}

{% block body_id %}home-page{% endblock %}

{% block content %}
<h1>VÃ­tejte v aplikaci â€Hejbni kostrou!" ğŸ¦´ğŸƒâ€â™‚ï¸ğŸ¤¸â€â™‚ï¸</h1>

<div class="menu-container">
    <div class="skolni-rok-container">
        <span>Å kolnÃ­ rok:</span>
        <select id="skolniRok" name="skolniRok">
            {% for rok in skolni_roky %}
                <option value="{{ rok.rok_od }}/{{ rok.rok_do }}" {% if rok.aktualni %}selected{% endif %}>
                    {{ rok.rok_od }}/{{ rok.rok_do }}
                </option>
            {% endfor %}
        </select>        
    </div>    
</div>

<div>    
    <a href="/zaci" class="button">Seznam Å¾Ã¡kÅ¯</a>
    <form action="/vyhledat" method="GET" class="search-container" id="searchForm">
        <input type="text" id="searchInput" name="query" placeholder="ğŸ” Vyhledat Å¾Ã¡ka..."
            class="search-input" autocomplete="off">
    </form>          
    <a href="/tridy" class="button">TÅ™Ã­dy</a>
    <a href="/zebricky_a_statistiky" class="button">Å½ebÅ™Ã­Äky a statistiky</a>
    <a href="/discipliny" class="button">DisciplÃ­ny</a>
    <a href="/odkazy_a_informace" class="button">Odkazy a informace</a>
    
    <!-- PÅ™idÃ¡nÃ­ tlaÄÃ­tka pro import novÃ½ch Å¾Ã¡kÅ¯ -->
    <a href="#" id="importNovychZakuBtn" class="button">Import novÃ½ch Å¾Ã¡kÅ¯</a>
</div>

<div class="headline-container">
    <h2>Pohyb je zÃ¡klad zdravÃ©ho Å¾ivotnÃ­ho stylu, a proto jsme tu! Aplikace je vytvoÅ™ena pro ÃºÄely tÄ›lesnÃ© vÃ½chovy na ZÅ  Svatopluka ÄŒecha ChoceÅˆ a je pÅ™izpÅ¯sobena potÅ™ebÃ¡m uÄitelÅ¯ i Å¾Ã¡kÅ¯, aby podpoÅ™ila dlouhodobÃ½ rozvoj pohybovÃ½ch dovednostÃ­.</h2>
</div>

<!-- âœ… SprÃ¡vnÃ© rozloÅ¾enÃ­ obsahu -->
<div class="content-container">
    <!-- LevÃ¡ ÄÃ¡st s logem -->
    <div class="left-side">
        <div class="logo-hlavni-container">
            <a href="{{ url_for('home') }}">
                <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo aplikace" class="logo-hlavni">
            </a>
        </div>
    </div>

    <!-- PravÃ¡ ÄÃ¡st s textem -->
    <div class="right-side">
        <div class="info-container">
            <h3>ğŸ‘¦ğŸ‘§ Pro Å¾Ã¡ky:</h3>
            <p>Chcete se posouvat vpÅ™ed a vidÄ›t vÃ½sledky? Jste tu sprÃ¡vnÄ›! NavÃ­c mÅ¯Å¾ete zÃ­skÃ¡vat body za vaÅ¡i snahu! NezÃ¡leÅ¾Ã­ na startovnÃ­ pozici, dÅ¯leÅ¾itÃ½ je pokrok!</p>

            <h3>ğŸ§‘â€ğŸ« Pro uÄitele:</h3>
            <p>SystÃ©m vÃ¡m usnadnÃ­ evidenci vÃ½konÅ¯ Å¾Ã¡kÅ¯ a jejich monitoring. Å½Ã¡dnÃ© papÃ­ry<br>a sloÅ¾itÃ© pÅ™epoÄty â€“ zde vÅ¡e najdete pÅ™ehlednÄ› na jednom mÃ­stÄ›.</p>

            <h3>â¬…ï¸ Co zde najdete?</h3>
            <ul>
                <li><b>Seznam Å¾Ã¡kÅ¯</b> â€“ RychlÃ½ pÅ™Ã­stup k vÃ½sledkÅ¯m jednotlivÃ½ch Å¾Ã¡kÅ¯.</li>
                <li><b>TÅ™Ã­dy</b> â€“ PÅ™ehled vÃ½konÅ¯ celÃ© tÅ™Ã­dy.</li>
                <li><b>Å½ebÅ™Ã­Äky a statistiky</b> â€“ Statistiky a srovnÃ¡nÃ­ nejlepÅ¡Ã­ch vÃ½konÅ¯.</li>
                <li><b>DisciplÃ­ny</b> â€“ Seznam, zÃ¡pis a vÃ½sledky vÅ¡ech disciplÃ­n.</li>
                <li><b>Odkazy a informace</b> â€“ UÅ¾iteÄnÃ© materiÃ¡ly a dalÅ¡Ã­ informace.</li>
            </ul>

            <h3>â¡ï¸ Jak pokraÄovat?</h3>
            <p>Vyberte si z nabÃ­dky a zaÄnÄ›te sledovat svÅ¯j pokrok! ğŸ’ª</p>
        </div>
    </div>
</div>

<!-- PÅ™idat modÃ¡lnÃ­ okno pro import Å¾Ã¡kÅ¯ pÅ™ed konec obsahu -->
<div id="importModal" class="modal">
    <div class="modal-content import-modal-content">
        <span class="close">&times;</span>
        <h2>Import novÃ½ch Å¾Ã¡kÅ¯ 6. roÄnÃ­ku</h2>
        <p>Nahrajte Excel soubor se seznamem novÃ½ch Å¾Ã¡kÅ¯. FormÃ¡t musÃ­ bÃ½t stejnÃ½ jako pro stÃ¡vajÃ­cÃ­ Å¾Ã¡ky.</p>
        
        <form id="importForm" enctype="multipart/form-data">
            <div class="form-group">
                <label for="excelFile">Vyberte Excel soubor:</label>
                <input type="file" id="excelFile" name="excelFile" accept=".xlsx, .xls" required>
            </div>
            
            <div class="form-group">
                <button type="submit" class="submit-btn">Importovat Å¾Ã¡ky</button>
            </div>
        </form>
        
        <div id="importStatus"></div>
    </div>
</div>

<script>
    // KÃ³d pro inicializaci interaktivnÃ­ch prvkÅ¯ domovskÃ© strÃ¡nky
    document.addEventListener("DOMContentLoaded", function() {
        // VÅ¡echen kÃ³d zde...
        let ulozenyRok = localStorage.getItem("skolniRok");
        // KÃ³d pro vÃ½bÄ›r Å¡kolnÃ­ho roku
        function zmenRok() {
            let vybranyRok = document.getElementById("skolniRok").value;

            // UloÅ¾Ã­me novÃ½ Å¡kolnÃ­ rok do localStorage
            localStorage.setItem("skolniRok", vybranyRok);

            // OkamÅ¾itÄ› aktualizujeme text v pravÃ©m hornÃ­m rohu na vÅ¡ech strÃ¡nkÃ¡ch
            let skolniRokText = document.getElementById("skolni-rok-text");
            if (skolniRokText) {
                skolniRokText.innerText = vybranyRok;
            }

            console.log("Å kolnÃ­ rok zmÄ›nÄ›n na:", vybranyRok);
        }

        // ğŸ†• NaÄÃ­tÃ¡nÃ­ uloÅ¾enÃ©ho Å¡kolnÃ­ho roku pÅ™i otevÅ™enÃ­ strÃ¡nky
        document.addEventListener("DOMContentLoaded", function() {
            let ulozenyRok = localStorage.getItem("skolniRok");
            let skolniRokSelect = document.getElementById("skolniRok");
            let skolniRokText = document.getElementById("skolni-rok-text");

            if (ulozenyRok) {
                if (skolniRokSelect) {
                    skolniRokSelect.value = ulozenyRok;
                }

                if (skolniRokText) {
                    skolniRokText.innerText = ulozenyRok;
                }

                console.log("NaÄtenÃ½ Å¡kolnÃ­ rok z localStorage:", ulozenyRok);
            }
        });

        document.addEventListener("DOMContentLoaded", function () {
            // Najdeme vyhledÃ¡vacÃ­ pole
            let searchInput = document.getElementById("searchInput");

            // Pouze na home strÃ¡nce resetujeme vyhledÃ¡vacÃ­ pole
            if (searchInput && document.body.id === "home-page") {
                searchInput.value = ""; // Reset vyhledÃ¡vÃ¡nÃ­ jen pro home.html
            }
        });

        window.addEventListener("pageshow", function (event) {
            let searchInput = document.getElementById("searchInput");

            // Pouze pokud jsme na home.html a prohlÃ­Å¾eÄ naÄetl strÃ¡nku z cache
            if (searchInput && document.body.id === "home-page" && (event.persisted || window.performance.getEntriesByType("navigation")[0].type === "back_forward")) {
                searchInput.value = "";
            }
        });

        // NutÃ­me prohlÃ­Å¾eÄ neuklÃ¡dat strÃ¡nku do cache pouze na home.html
        if (document.body.id === "home-page" && "onpageshow" in window) {
            window.onpageshow = function (event) {
                if (event.persisted) {
                    location.reload(); // VynutÃ­ opÄ›tovnÃ© naÄtenÃ­ strÃ¡nky
                }
            };
        }

        document.addEventListener("DOMContentLoaded", function() {
            document.getElementById("skolniRok").addEventListener("change", function() {
                let novyRok = this.value;

                fetch("/zmen_skolni_rok", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ rok: novyRok })
                })
                .then(response => response.json())
                .then(data => {
                    console.log("ğŸ“¥ OdpovÄ›Ä z API:", data);  // ğŸ‘‰ Debugging

                    if (data.message) {
                        alert("âœ… " + data.message);
                        location.reload();
                    } else if (data.error) {
                        alert("âŒ Chyba pÅ™i zmÄ›nÄ› Å¡kolnÃ­ho roku: " + data.error);
                    } else {
                        alert("âŒ NeznÃ¡mÃ¡ chyba pÅ™i zmÄ›nÄ› Å¡kolnÃ­ho roku.");
                    }
                })
                .catch(error => {
                    console.error("âŒ Chyba pÅ™i komunikaci s API:", error);
                    alert("âŒ Chyba pÅ™i zmÄ›nÄ› Å¡kolnÃ­ho roku: " + error);
                }); // ğŸ”¹ Tento Å™Ã¡dek byl sprÃ¡vnÄ› uzavÅ™en
            }); // ğŸ”¹ Tady chybÄ›la zÃ¡vorka!
        });

        // Reference na modal a jeho prvky
        const modal = document.getElementById("importModal");
        const importBtn = document.getElementById("importNovychZakuBtn");
        const closeBtn = document.querySelector(".close");
        const importForm = document.getElementById("importForm");
        const importStatus = document.getElementById("importStatus");

        // OtevÅ™enÃ­ modalu
        importBtn.addEventListener("click", function(e) {
            e.preventDefault();
            modal.style.display = "block";
        });

        // ZavÅ™enÃ­ modalu
        closeBtn.addEventListener("click", function() {
            modal.style.display = "none";
            importStatus.style.display = "none";
            importForm.reset();
        });

        // ZavÅ™enÃ­ modalu kliknutÃ­m mimo jeho obsah
        window.addEventListener("click", function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
                importStatus.style.display = "none";
                importForm.reset();
            }
        });

        // ZpracovÃ¡nÃ­ formulÃ¡Å™e pro import Å¾Ã¡kÅ¯
        importForm.addEventListener("submit", function(e) {
            e.preventDefault();
            
            const fileInput = document.getElementById("excelFile");
            if (!fileInput.files[0]) {
                showImportStatus("Vyberte soubor pro import.", "error");
                return;
            }

            const formData = new FormData();
            formData.append("excelFile", fileInput.files[0]);

            // ZpracovÃ¡nÃ­ nahrÃ¡vÃ¡nÃ­ a importu
            importStatus.innerHTML = "Import probÃ­hÃ¡, Äekejte prosÃ­m...";
            importStatus.className = "";
            importStatus.style.display = "block";

            fetch("/import_novi_zaci_6_rocniku", {
                method: "POST",
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showImportStatus(data.message || "Import byl ÃºspÄ›Å¡nÄ› dokonÄen!", "success");
                } else {
                    showImportStatus(data.error || "PÅ™i importu doÅ¡lo k chybÄ›.", "error");
                }
            })
            .catch(error => {
                console.error("Chyba pÅ™i importu:", error);
                showImportStatus("PÅ™i importu doÅ¡lo k technickÃ© chybÄ›.", "error");
            });
        });

        // ZobrazenÃ­ statusu importu
        function showImportStatus(message, type) {
            importStatus.innerHTML = message;
            importStatus.className = type;
            importStatus.style.display = "block";
            
            if (type === "success") {
                // Po ÃºspÄ›Å¡nÃ©m importu resetujeme formulÃ¡Å™
                setTimeout(() => {
                    importForm.reset();
                }, 2000);
            }
        }
    });
</script>
{% endblock %}